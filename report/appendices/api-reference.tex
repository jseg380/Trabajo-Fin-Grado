\chapter{API Endpoint Specification}

This appendix provides a comprehensive specification for the RESTful API that powers the \textit{AlDiaCAR} backend. The API is designed following REST principles, utilizing standard HTTP methods and status codes. All data is exchanged in the JSON format. Access to sensitive endpoints is controlled via a JWT-based authentication system, as detailed in Chapter 4.

\textgap

All specified routes in the following table are prefixed with \texttt{/api}. For example, the route listed as \texttt{/auth/register} corresponds to the full endpoint \texttt{/api/auth/register}.

\begin{longtable}{|p{0.1\textwidth}|p{0.3\textwidth}|p{0.4\textwidth}|p{0.12\textwidth}|}
    \caption{AlDiaCAR API Endpoint Definitions}\\
    \hline
    \textbf{Method} & \textbf{Route} & \textbf{Description} & \textbf{Protected} \\
    \hline
    \endfirsthead
    
    \multicolumn{4}{c}%
    {{\bfseries \tablename\ \thetable{} -- continued from previous page}} \\
    \hline
    \textbf{Method} & \textbf{Route} & \textbf{Description} & \textbf{Protected} \\
    \hline
    \endhead
    
    \hline \multicolumn{4}{r}{{Continued on next page}} \\ \hline
    \endfoot
    
    \hline
    \endlastfoot

    % --- Authentication Endpoints ---
    \multicolumn{4}{|c|}{\textbf{Authentication and User Management}} \\
    \hline
    POST & \texttt{/auth/register} & Registers a new user and creates a personal household for them. & No \\
    \hline
    POST & \texttt{/auth/login} & Authenticates a user and returns a JWT in an HttpOnly cookie. & No \\
    \hline
    POST & \texttt{/auth/logout} & Clears the authentication cookie, logging the user out. & No \\
    \hline
    GET & \texttt{/users/profile} & Retrieves the profile information for the currently authenticated user. & Yes \\
    \hline
    PUT & \texttt{/users/profile/avatar} & Updates the authenticated user's profile picture. Expects multipart/form-data. & Yes \\
    \hline

    % --- Household Endpoints ---
    \multicolumn{4}{|c|}{\textbf{Household Management}} \\
    \hline
    GET & \texttt{/households/my-household} & Retrieves the details of the household the current user belongs to, including a list of members. & Yes \\
    \hline
    POST & \texttt{/households/join} & Allows the current user to join an existing household using a join code. & Yes \\
    \hline
    POST & \texttt{/households/leave} & Allows the current user to leave their current household. A new personal household is created for them. & Yes \\
    \hline

    % --- Vehicle Endpoints ---
    \multicolumn{4}{|c|}{\textbf{Vehicle Fleet Management (CRUD)}} \\
    \hline
    POST & \texttt{/vehicles} & Creates a new vehicle and associates it with the authenticated user as the owner. & Yes \\
    \hline
    GET & \texttt{/vehicles} & Retrieves a list of all vehicles owned by any member of the user's current household. & Yes \\
    \hline
    GET & \texttt{/vehicles/:id} & Retrieves the details of a single vehicle by its ID. & Yes \\
    \hline
    PUT & \texttt{/vehicles/:id} & Updates the details of a specific vehicle. Can be used for general info or for updating maintenance schedules. & Yes \\
    \hline
    DELETE & \texttt{/vehicles/:id} & Deletes a vehicle from the system. & Yes \\
    \hline
    
    % --- Vehicle Status Endpoints ---
    \multicolumn{4}{|c|}{\textbf{Vehicle Status and Coordination}} \\
    \hline
    POST & \texttt{/vehicles/:id/checkout} & Marks a vehicle as 'in\_use' by the authenticated user. & Yes \\
    \hline
    POST & \texttt{/vehicles/:id/checkin} & Marks a vehicle as 'at\_home', making it available again. & Yes \\
    \hline
    POST & \texttt{/vehicles/:id/reserve} & Reserves a vehicle for a specified future time slot. Requires `reservedFrom` and `reservedUntil` in the body. & Yes \\
    \hline
    POST & \texttt{/vehicles/:id/cancel-reservation} & Cancels an existing reservation made by the authenticated user. & Yes \\
    \hline
    
    % --- Core Feature Endpoints ---
    \multicolumn{4}{|c|}{\textbf{Core Application Features}} \\
    \hline
    GET & \texttt{/maintenance/summary} & Retrieves a consolidated and sorted list of all upcoming and overdue maintenance tasks for the user's household fleet. & Yes \\
    \hline
    POST & \texttt{/recommendations} & The core recommendation engine. Takes trip details (`origin`, `destination`, `distance`) and returns a sorted list of recommended vehicles. & Yes \\
    \hline
    GET & \texttt{/stats} & Retrieves aggregated statistics for the authenticated user, such as total distance traveled and total emissions. & Yes \\
    \hline
    POST & \texttt{/trips/log} & Logs the completion of a trip, updating vehicle maintenance counters and user statistics. & Yes \\
    \hline

    % --- Development Endpoint ---
    \multicolumn{4}{|c|}{\textbf{Development and Testing}} \\
    \hline
    POST & \texttt{/init-db} & \textbf{(Development Only)} Clears and seeds the database with a predefined set of test users, vehicles, and trips. & No \\
    \hline

\end{longtable}
