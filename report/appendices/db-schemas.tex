\chapter{Appendix: Database Schemas}

This appendix details the Mongoose schemas used to structure data in the MongoDB database. Each schema corresponds to a collection and defines the shape and constraints of its documents.

\section{User Schema (\texttt{users} collection)}
Defines the structure for user accounts, including authentication details, profile information, and gamification state.

\begin{itemize}
    \item \texttt{\_id: ObjectId} \textit{(Primary key, auto-generated by MongoDB)}
    \item \texttt{name: String} \textit{(Required)}
    \item \texttt{email: String} \textit{(Required, unique, indexed)}
    \item \texttt{password: String} \textit{(Required. Hashed via bcrypt and never returned in queries due to \texttt{select: false})}
    \item \texttt{avatar: String} \textit{(Path to the user's profile image, with a generic default)}
    \item \texttt{stats: Object} \textit{(A sub-document tracking user statistics)}
        \begin{itemize}
            \item \texttt{distanceTraveled: Number}
            \item \texttt{co2Saved: Number}
            \item \texttt{totalVehicles: Number}
        \end{itemize}
    \item \texttt{achievements: [String]} \textit{(An array of unique keys for earned achievements, e.g., 'FIRST\_TRIP')}
    \item \texttt{createdAt: Date} \textit{(Auto-managed by Mongoose's timestamps option)}
    \item \texttt{updatedAt: Date} \textit{(Auto-managed by Mongoose's timestamps option)}
\end{itemize}

\section{Vehicle Schema (\texttt{vehicles} collection)}
Defines the structure for user-owned vehicles, including their specifications and maintenance schedules.

\begin{itemize}
    \item \texttt{\_id: ObjectId} \textit{(Primary key)}
    \item \texttt{owner: ObjectId} \textit{(Foreign key referencing the \texttt{User} collection, required)}
    \item \texttt{make: String} \textit{(Required)}
    \item \texttt{model: String} \textit{(Required)}
    \item \texttt{year: Number} \textit{(Required)}
    \item \texttt{fuelType: String} \textit{(Required, constrained by an enum: 'gasoline', 'diesel', 'electric', 'hybrid')}
    \item \texttt{emissions: Number} \textit{(CO\textsubscript{2} emission factor in g/km)}
    \item \texttt{upcomingMaintenance: Object} \textit{(A sub-document with default maintenance intervals set upon creation)}
        \begin{itemize}
            \item \texttt{tires: \{ date: Date, distance: Number \}}
            \item \texttt{brakes: \{ distance: Number \}}
            \item \texttt{oilChange: \{ distance: Number \}}
            \item \texttt{itv: Date}
        \end{itemize}
\end{itemize}

\section{Trip Schema (\texttt{trips} collection)}
Defines the structure for a single logged journey, linking a user and a vehicle to performance metrics.

\begin{itemize}
    \item \texttt{\_id: ObjectId} \textit{(Primary key)}
    \item \texttt{driver: ObjectId} \textit{(Foreign key referencing the \texttt{User} collection, required)}
    \item \texttt{vehicle: ObjectId} \textit{(Foreign key referencing the \texttt{Vehicle} collection, required)}
    \item \texttt{locations: Object} \textit{(GeoJSON sub-document for location data)}
        \begin{itemize}
            \item \texttt{start: \{ type: 'Point', coordinates: [Number, Number] \}}
            \item \texttt{end: \{ type: 'Point', coordinates: [Number, Number] \}}
        \end{itemize}
    \item \texttt{distance: Number} \textit{(Total trip distance in km, required)}
    \item \texttt{date: Date} \textit{(Timestamp for when the trip occurred, defaults to \texttt{Date.now})}
    \item \texttt{calculatedEmissions: Number} \textit{(Total emissions in gCO\textsubscript{2}, required)}
\end{itemize}
